function drawing(t){var a,e,n=parseDate(t.date),r=t.cell,i="r";UI.collapsed&&(a=Utility.getCurrentStaus(n),i=a.status,e=a.offset);var l=[];l.push('<div class="top"></div>'),l.push(n.getDate()),l.push('<div class="bottom '+i+'"></div>'),r.innerHTML=l.join(""),UI.resizeUI()}function getNextMonth(t){return new Date(t.getFullYear(),t.getMonth()+1,t.getDate())}function createCalInstance(){var t=function(t){return document.getElementById(t)},a=["日","一","二","三","四","五","六"];calCurrent=new MonthlyCalendar({container:t("cal-current"),displayDays:a,autoRows:!0,displayRows:6,ondrawing:function(t){drawing(t),$("#cal-ind-current").text(calCurrent.getCurrentDate().format("yyyy 年 MM 月"))},onselect:function(t){if(UI.disabledFlag)return UI.updateMessage(t.date);var a=parseDate(t.date);$("#startdate").val(t.date),Data.getFormData(),UI.collapse(),console.log(a),calCurrent.draw(a);var e=getNextMonth(calCurrent.getCurrentDate());calNext.draw(e),UI.disabled()}}),calNext=new MonthlyCalendar({container:t("cal-next"),displayDays:a,autoRows:!0,displayRows:6,onselect:function(t){return UI.updateMessage(t.date)},ondrawing:function(t){drawing(t),$("#cal-ind-next").text(calNext.getCurrentDate().format("yyyy 年 MM 月"))}}),calCurrent.draw(new Date),calNext.draw(getNextMonth(calCurrent.getCurrentDate()))}var STATUS_Y="y",STATUS_G="g",STATUS_R="r",calCurrent,calNext;Date.prototype.range=function(t,a){var e="yyyyMMdd",n=parseInt(this.format(e),10),r=parseInt(t.format(e),10),i=parseInt(a.format(e),10);return n>=r&&i>=n?!0:!1},Date.prototype.diffDay=function(t){var a=this.valueOf(),e=t.valueOf(),n=864e5,r=1;return r=e>a?(e-a)/n:(a-e)/n,parseInt(r,10)};var Data={startdate:null,circle:0,days:0,yiji:{g:{},r:{},y:{}},initCallback:function(){},getFormData:function(t,a,e){this.startdate=t||parseDate($("#startdate").val()),this.circle=a||parseInt($("#circle").val(),10),this.days=e||4},init:function(t,a,e){Data.getFormData(t,a,e),Data.fetch()},fetch:function(){var counter=0;$.ajax({url:"data/yiji/yiji_anquanqi.json",type:"GET",dataType:"text",success:function(data){var data=eval("("+data+")");Data.yiji.g=data,counter++,$.ajax({url:"data/yiji/yiji_jingqi.json",dataType:"text",success:function(data){var data=eval("("+data+")");Data.yiji.r=data,counter++,$.ajax({url:"data/yiji/yiji_pailuanqi.json",dataType:"text",success:function(data){var data=eval("("+data+")");Data.yiji.y=data,counter++,Data.initCallback&&Data.initCallback()}})}})}})},set:function(t){t&&(Data.startdate=t)},get:function(){return{startdate:Data.startdate,circle:Data.circle,days:Data.days,yiji:Data.yiji}},check:function(){var t=this.startdate,a=this.circle,e=this.days;return t&&"Invalid Date"!=t?1>=a?(alert("请正确填写「月经周期」，必须 >= 1"),!1):(1>=e&&alert("请正确填写「行经天数」，必须 >= 1"),!0):(alert("请输入第一次来月经的时间"),!1)}},Utility=function(){var t=14;return{switchMonth:function(t,a,e){var n,r=new Date(a.getFullYear(),a.getMonth()+t,a.getDate()),i=new Date(r.getFullYear(),r.getMonth(),1),l=new Date(r.getFullYear(),r.getMonth()+1,-1),s=1;do n=new Date(a.getFullYear(),a.getMonth(),a.getDate()+s*e),t>0?s++:s--;while(!n.range(i,l));return n},getCurrentStaus:function(a){var e,n,r,i,l,s,c=Data.get().startdate,o=Data.get().circle,d=Data.get().days,u=c.getFullYear(),g=c.getMonth(),D=c.getDate(),f=1;a=parseDate(a),e=new Date(u,g,D-t),r=new Date(e.getFullYear(),e.getMonth(),e.getDate()-5),i=new Date(e.getFullYear(),e.getMonth(),e.getDate()+4),n=new Date(u,g,D+o-t),l=new Date(n.getFullYear(),n.getMonth(),n.getDate()-5),s=new Date(n.getFullYear(),n.getMonth(),n.getDate()+4);var y=STATUS_G;return a.range(r,i)&&(y=STATUS_Y,f=r.diffDay(a)),a.range(l,s)&&(y=STATUS_Y,f=l.diffDay(a)),a.range(new Date(u,g,D-o),new Date(u,g,D-o+d))&&(y=STATUS_R,f=a.diffDay(new Date(u,g,D-o))),a.range(c,new Date(u,g,D+d))&&(y=STATUS_R,f=a.diffDay(c)),a.range(new Date(u,g,D+o),new Date(u,g,D+o+d))&&(y=STATUS_R,f=a.diffDay(new Date(u,g,D+o))),{status:y,offset:f}}}}(),UI={duration:500,collapsed:!1,disabledFlag:!1,data:null,init:function(t){$("#btn-reset").on("click",function(){UI.toggle(),UI.enabled()}),$("#cal-sel-prev-month").on("click",function(){calCurrent.drawPreviousMonth()}),$("#cal-sel-next-month").on("click",function(){calCurrent.drawNextMonth()}),this.setData(t)},setData:function(t){t&&(this.data=t)},disabled:function(){UI.disabledFlag=!0,$("#cal-sel-prev-month").hide(),$("#cal-sel-next-month").hide()},enabled:function(){UI.disabledFlag=!1,$("#cal-sel-prev-month").show(),$("#cal-sel-next-month").show()},toggle:function(){UI.collapsed?UI.reset():UI.collapse()},collapse:function(){var t=UI.duration,a=parseInt($(".cal-current").width()/2,10)+5;$(".cal-current").css({display:"block"}).animate({left:-a+"px"},t,"linear"),$(".cal-next").css({display:"block",opacity:0}).animate({left:a+"px",opacity:1},t,"linear"),$("#status").show(),$("#btn-reset").show(),$("#literal-tip").hide(),UI.collapsed=!0},reset:function(){var t=UI.duration;$(".cal-current").css({display:"block"}).animate({left:"0px"},t,"linear"),$(".cal-next").css({display:"block"}).animate({left:"0px",opacity:0},t,"linear",function(){$(".cal-next").css({display:"none"})}),$("#status").hide(),$("#btn-reset").hide(),$("#literal-tip").show(),$("#cal-container").addClass("unselected"),UI.collapsed=!1},resizeUI:function(){var t=$("#cal-container"),a=239;calCurrent.displayRows+calNext.displayRows>10&&(a=275),UI.collapsed&&t.height(a).removeClass("unselected")},updateMessage:function(t){var a=Utility.getCurrentStaus(parseDate(t)),e=a.status,n=a.offset,r=UI.data.yiji[e].yi_list.splice(3*n,3),i=UI.data.yiji[e].ji_list.splice(3*n,3);$("#status .good .info").text(r.join("，")),$("#status .bad .info").text(i.join("，"))}};$(function(){Data.initCallback=function(){createCalInstance(),UI.init(Data)},Data.init()});