var calendarPicker=function(){var e,a,t,n,r,c,l,i,o=function(e){return document.getElementById(e)},d=new Date,s=null;return{instance:s,textbox:null,bindToClass:"calendar-picker",selectedDate:null,initialize:function(e){Object.mix(this,e,!0),calendarPicker.insertHTMLs(),calendarPicker.initRef(),calendarPicker.initEvents(),calendarPicker.bind()},initRef:function(){e=o("cal-overlay"),t=o("cal-mask"),a=o("cal-wrap"),n=o("cal-next-month"),r=o("cal-pre-month"),c=o("cal-pre-year"),l=o("cal-next-year"),i=o("cal-date-info"),s=new MonthlyCalendar({container:a,displayDays:["日","一","二","三","四","五","六"],onchange:function(){i.innerHTML=s.getCurrentDate().format()}})},initEvents:function(){l.onclick=function(){s.drawNextYear()},c.onclick=function(){s.drawPreviousYear()},n.onclick=function(){s.drawNextMonth()},r.onclick=function(){s.drawPreviousMonth()},s.on("select",function(e){calendarPicker.textbox.value=e.date,i.innerHTML=calendarPicker.selectedDate=e.date,calendarPicker.hide()}),s.on("drawing",function(e){calendarPicker.selectedDate&&calendarPicker.selectedDate==e.date.format()&&dom.addClass(e.cell,"highlight")})},insertHTMLs:function(){var e='				<div id="cal-mask"></div>		  		<div id="cal-overlay">				  	<div id="calendar-op">				  		<a href="javascript:;" title="上一年" id="cal-pre-year">&lt;&lt;</a>&nbsp;&nbsp;&nbsp;&nbsp;				  		<a href="javascript:;" title="上一月" id="cal-pre-month">&lt;</a>&nbsp;&nbsp;&nbsp;&nbsp;				  		<span id="cal-date-info">loading...</span>&nbsp;&nbsp;&nbsp;&nbsp;				  		<a href="javascript:;" title="下一月" id="cal-next-month">&gt;</a>&nbsp;&nbsp;&nbsp;&nbsp;				  		<a href="javascript:;" title="下一年" id="cal-next-year">&gt;&gt;</a>				  	</div>					<div id="cal-wrap">loading...</div>				</div>',a="				#cal-mask { background:#000; opacity:0.7; width:100%; height:100%;left:0;top:0;position:absolute;display:none} 				#cal-overlay { width:100%;bottom:0px;position:absolute;display:none;text-align:center; cursor:default;}				#cal-wrap table {-webkit-tap-highlight-color:rgba(255,255,255,0.5)}				#cal-wrap .calendar-header {background:#F8F8F8;}				#cal-wrap .calendar-day { color:#000;font-weight:bolder;height:25px;}				#cal-wrap .calendar-header .day-sunday,				#cal-wrap .calendar-header .day-saturday {color:#000;}				#cal-wrap table {border-collapse:collapse;width:100%;}				#cal-wrap .calendar-date {-webkit-tap-highlight-color:rgba(255,255,255,0.5);background:#fff;border-bottom:1px solid #ccc;padding:8px;color:#000;text-align:center;}				#cal-wrap .calendar-not-the-month {background:#fff;color:#ddd;}				#cal-wrap .calendar-today {background:#eee;}				#cal-wrap .highlight {background:#eee;}				#cal-wrap .calendar-hover {background:#eee;}				#cal-wrap .calendar-invalid {background:#FAEAC6;text-decoration: line-through;}				#calendar-op {color:#000;background:#eee;padding:8px;color:#000}				#calendar-op a {text-decoration:none;color:#000;}",t=document.createElement("style");t.type="text/css",t.styleSheet?t.styleSheet.cssText=a:t.appendChild(document.createTextNode(a)),document.getElementsByTagName("head")[0].appendChild(t);var n=document.createElement("div");document.body.appendChild(n),n.innerHTML=e},bind:function(){for(var a=dom.getElementsByClassName(calendarPicker.bindToClass),t=0,n=a.length;n>t;t++)$(a[t]).on("focus",function(t){return function(){var n=a[t];calendarPicker.setDate(n.value),n.blur(),e.focus();var r=n.getAttribute("data-min-date"),c=n.getAttribute("data-max-date");r&&(s.minDate=parseDate(r)),c&&(s.maxDate=parseDate(c)),s.draw(d),calendarPicker.textbox=n,calendarPicker.show()}}(t)),a[t].onblur=function(){};var r=function(a){var t=eventH.target(a);dom.contains(e,t)||calendarPicker.textbox==t||calendarPicker.hide()};eventTargetH.on(document,"click",r),eventTargetH.on(document,"keyup",r)},show:function(){e.style.display="block",e.style.zIndex="100",e.style.position="absolute",t.style.display="block",t.style.zIndex="99"},hide:function(){e.style.display="none",t.style.display="none"},setDate:function(e){return e=e||new Date,"string"==typeof e?(d=parseDate(e),d="Invalid Date"==d.toString()||isNaN(d)?new Date:d):d=e,d}}}();