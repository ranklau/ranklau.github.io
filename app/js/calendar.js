!function(){function t(){return this._initialize.apply(this,arguments)}eventH.target=eventH.target,dom.contains=dom.contains,dom.create=dom.create,dom.outerHTML=dom.outerHTML,classH.extend=classH.extend,eventTargetH.on=eventTargetH.on,ce=CustEvent,mix=Object.mix,parseDate=parseDate,formatDate=formatDate,log=log;var e=0,a="icalendar-",n=new Date,r="select",s="beforedraw,drawing,afterdraw",i="cellin,cellout",o="change,outofdate",l="beforeshow,show,aftershow,beforehide,hide,afterhide";Object.mix(t.prototype,{container:null,currentDate:new Date,minDate:new Date(n.getFullYear()-2,n.getMonth(),n.getDate()),maxDate:new Date(n.getFullYear()+2,n.getMonth(),n.getDate()),uid:null,lastDrawDate:null,isDateOutOfRange:!1,_initEvents:!1,_initialize:function(t){return e+=1,this.uid=e,Object.mix(this,t||{},!0),ce.createEvents(this,r),ce.createEvents(this,s),ce.createEvents(this,i),ce.createEvents(this,o),ce.createEvents(this,l),this},dispose:function(){},getCurrentDate:function(){return this.currentDate},setCurrentDate:function(t){if(!t)throw new Error(["Calendar","setCurrentDate","setCurrentDate arguments oDate is not a Date type"]);this.currentDate=t},setContainer:function(t){if(!t)throw new Error(["Calendar","setContainer","setContainer arguments container is not a HTMLELement"]);this.container=t},formatDate:function(){return formatDate.apply(this,arguments)},parseDate:function(){return parseDate.apply(this,arguments)}});var d=classH.extend(function(){return arguments.callee.$super.apply(this,arguments),this._init.apply(this,arguments)},t,!1);mix(d.prototype,{initDayIndex:0,displayRows:5,displayMonths:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],displayDays:["周日","周一","周二","周三","周四","周五","周六"],startDate:null,endDate:null,autoRows:!0,displayHeader:!0,baseClass:"calendar-base-class",className:{days:["day-sunday calendar-day","day-monday calendar-day","day-tuesday calendar-day","day-wednesday calendar-day","day-thursday calendar-day","day-friday calendar-day","day-saturday calendar-day"],dates:["date-sunday calendar-date","date-monday calendar-date","date-tuesday calendar-date","date-wednesday calendar-date","date-thursday calendar-date","date-friday calendar-date","date-saturday calendar-date"],header:"calendar-header",today:"calendar-today",invalid:"calendar-invalid",notTheMonth:"calendar-not-the-month",hover:"calendar-hover"},firstDayOffset:1,_init:function(){var t=this;t.on("drawing",function(e){var a=e.cell,n=e.date,r=t.getCurrentDate();n.getMonth()!=r.getMonth()&&dom.addClass(a,t.className.notTheMonth),n.format()==(new Date).format()&&dom.addClass(a,t.className.today),t.checkDateOutOfRange(n)&&dom.addClass(a,t.className.invalid)}),t.on("cellin",function(e){dom.addClass(e.cell,t.className.hover)}),t.on("cellout",function(e){dom.removeClass(e.cell,t.className.hover)})},bindEvents:function(){if(!this._initEvents){var t=this,e=this.container,a=null,n=function(t){if(t&&t.getAttribute&&t.getAttribute("data-icalendar"))return t;for(;t=t.parentNode;)if(t&&t.getAttribute&&t.getAttribute("data-icalendar"))return t;return null};eventTargetH.on(e,"click",function(a){var r,s,i=eventH.target(a);i&&dom.contains(e,i)&&(i=n(i),r=i.getAttribute("data-icalendar"),s={cell:i,date:r},t.fire("select",s))}),eventTargetH.on(e,"mouseover",function(r){var s,i,o,l=eventH.target(r);l=n(l),l!=a&&l&&dom.contains(e,l)&&(o=l.getAttribute("data-icalendar"),s={cell:l,date:o},t.fire("cellin",s),a&&(i={cell:a,date:a.getAttribute("data-icalendar")},t.fire("cellout",i)),a=l)}),eventTargetH.on(e,"mouseleave",function(){a&&(mouseoutArgs={cell:a,date:a.getAttribute("data-icalendar")},t.fire("cellout",mouseoutArgs),a=null)}),this._initEvents=!0}},checkDateOutOfRange:function(t){if(t=t||this.currentDate,"[object Date]"!=Object.prototype.toString.call(t))throw new Error(["Calendar","checkDateOutOfRange","checkDateOutOfRange arguments oDate["+t+"] is not Date instance."]);var e=!1,a=parseFloat(t.format("yyyyMMdd"),10),n=parseFloat(this.maxDate.format("yyyyMMdd"),10),r=parseFloat(this.minDate.format("yyyyMMdd"),10);return(a>n||r>a)&&(e=!0),this.isDateOutOfRange=e,e},buildHeader:function(t){var e,a=this.displayDays.length,n=this.className.days,r=this.displayDays,s=this.initDayIndex,i=t.insertRow(t.rows.length);i.className=this.className.header;for(var o=0;a>o;o++){var l=(o+s)%a;e=document.createElement("th"),i.appendChild(e),e.className=n[l],e.innerHTML=r[l]}return t},fixedDisplayRows:function(){this.displayRows=parseInt(this.displayRows,10),this.autoRows&&this.setAutoDisplayRows()},buildBody:function(t){t=t||this.currentDate;var e,n,r,s='<table cellpadding="0" cellspacing="0" class="'+this.baseClass+'" id="'+a+this.uid+'"><tbody>',i="</tbody></table>";cols=this.displayDays.length,rows=this.displayRows,className=this.className.dates;var o,l=t.getFullYear(),d=t.getMonth(),u=(t.getDate(),t.getDay(),-this.firstDayOffset+1),c=null,h=null,D=null,f=null;e=dom.create(s+i),this.displayHeader&&this.buildHeader(e),this.startDate=new Date(l,d,u);for(var g=0,y=rows*cols;y>g;g++)0==g%cols&&(n=e.insertRow(e.rows.length)),c=new Date(l,d,u+g),h=this.formatDate(c),D=(c.getDay()+this.initDayIndex)%cols,f=className[D],r=n.insertCell(n.cells.length),r.className=f,r.innerHTML=c.getDate(),r.setAttribute("data-icalendar",h),o={cell:r,date:c},this.fire("drawing",o);return this.endDate=c,e},setAutoDisplayRows:function(t){log("setAutoDisplayRows"),t=t||this.currentDate;var e=t.getMonth(),a=t.getFullYear(),n=5,r=7*this.displayRows,s=new Date(a,e+1,0).getDate(),i=this.getDateFirstDayOffset(t);return n=i+s>r?6:5,this.displayRows=n},getDateFirstDayOffset:function(t){t=t||this.getCurrentDate();var e=this.displayDays.length,a=(this.displayRows,t.getFullYear()),n=t.getMonth(),r=(t.getDate(),t.getDay(),new Date(a,n,1).getDay()),s=(r+e-this.initDayIndex)%e;return s},getStartDate:function(t){t=t||this.getCurrentDate();var e=(this.getDateFirstDayOffset(t),-this.firstDayOffset+1);return new Date(t.getFullYear(),t.getMonth(),e)},getEndDate:function(t){t=t||this.getCurrentDate();var e=(this.getDateFirstDayOffset(t),this.displayDays.length),a=this.displayRows,n=-this.firstDayOffset+1;return new Date(t.getFullYear(),t.getMonth(),n+e*a)},draw:function(){return this.drawDate.apply(this,arguments)},drawDate:function(t){t=t||this.getCurrentDate(),this.setCurrentDate(t),this.fixedDisplayRows(),this.checkDateOutOfRange(t)===!0&&this.fire("outofdate",{date:t,minDate:this.minDate,maxDate:this.maxDate});var e=beforeDrawArgs={cell:null,date:t};return this.firstDayOffset=this.getDateFirstDayOffset(t),log("[logging] firstDayOffset is "+this.firstDayOffset),this.fire("beforedraw",beforeDrawArgs),this.container.innerHTML=this.build(t),this.bindEvents(),t&&this.lastDrawDate!=t&&(this.fire("change",{currentDate:t,lastDate:this.lastDrawDate}),this.lastDrawDate=t),this.fire("afterdraw",e),this},getCellByDate:function(){},build:function(t){var e=dom.outerHTML(this.buildBody(t));return e},drawPreviousYear:function(){var t=this.getPreviousYear();this.drawDate(t)},getPreviousYear:function(t){var t=t||this.getCurrentDate(),e=t.getFullYear(),a=t.getMonth(),n=t.getDate();return new Date(e-1,a,n)},getNextYear:function(t){var t=t||this.getCurrentDate(),e=t.getFullYear(),a=t.getMonth(),n=t.getDate();return new Date(e+1,a,n)},getPreviousMonth:function(t){var t=t||this.getCurrentDate(),e=t.getFullYear(),a=t.getMonth(),n=t.getDate();return new Date(e,a-1,n)},getNextMonth:function(t){var t=t||this.getCurrentDate(),e=t.getFullYear(),a=t.getMonth(),n=t.getDate();return new Date(e,a+1,n)},drawNextYear:function(){var t=this.getNextYear();this.drawDate(t)},drawPreviousMonth:function(){var t=this.getPreviousMonth();this.drawDate(t)},drawNextMonth:function(){var t=this.getNextMonth();this.drawDate(t)},drawToday:function(){this.drawDate(new Date)},show:function(){this.fire("show"),this.container.style.display="block"},hide:function(){this.fire("hide"),this.container.style.display="none"}}),window.VitualBaseCalendar=t,window.MonthlyCalendar=d}();