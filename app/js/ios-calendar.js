var calendarPicker=function(){var e,a,n,t,c,r,l,i,d=function(e){return document.getElementById(e)},o=new Date,s=null;return{instance:s,textbox:null,bindToClass:"calendar-picker",selectedDate:null,initialize:function(e){Object.mix(this,e,!0),calendarPicker.insertHTMLs(),calendarPicker.initRef(),calendarPicker.initEvents(),calendarPicker.bind()},initRef:function(){e=d("cal-overlay"),n=d("cal-mask"),a=d("cal-wrap"),t=d("cal-next-month"),c=d("cal-pre-month"),r=d("cal-pre-year"),l=d("cal-next-year"),i=d("cal-date-info"),s=new MonthlyCalendar({container:a,displayDays:["日","一","二","三","四","五","六"],onchange:function(){i.innerHTML=s.getCurrentDate().format()}})},initEvents:function(){l.onclick=function(){s.drawNextYear()},r.onclick=function(){s.drawPreviousYear()},t.onclick=function(){s.drawNextMonth()},c.onclick=function(){s.drawPreviousMonth()},s.on("select",function(e){calendarPicker.textbox.value=e.date,i.innerHTML=calendarPicker.selectedDate=e.date,calendarPicker.hide()}),s.on("drawing",function(e){calendarPicker.selectedDate&&calendarPicker.selectedDate==e.date.format()&&dom.addClass(e.cell,"highlight")})},insertHTMLs:function(){var e='				<div id="cal-mask"></div>		  		<div id="cal-overlay">				  	<div id="calendar-op">				  		<a href="javascript:;" title="上一年" id="cal-pre-year">&lt;&lt;</a>&nbsp;&nbsp;&nbsp;&nbsp;				  		<a href="javascript:;" title="上一月" id="cal-pre-month">&lt;</a>&nbsp;&nbsp;&nbsp;&nbsp;				  		<span id="cal-date-info">loading...</span>&nbsp;&nbsp;&nbsp;&nbsp;				  		<a href="javascript:;" title="下一月" id="cal-next-month">&gt;</a>&nbsp;&nbsp;&nbsp;&nbsp;				  		<a href="javascript:;" title="下一年" id="cal-next-year">&gt;&gt;</a>				  	</div>					<div id="cal-wrap">loading...</div>				</div>',a="				#cal-mask { background:#000; opacity:0.7; width:100%; height:100%;left:0;top:0;position:absolute;display:none} 				#cal-overlay { width:100%;bottom:0px;position:absolute;display:none;text-align:center; cursor:default;}				#cal-wrap .calendar-header {background:#F8F8F8;}				#cal-wrap .calendar-day { color:#000;font-weight:bolder;height:25px;}				#cal-wrap .calendar-header .day-sunday,				#cal-wrap .calendar-header .day-saturday {color:#000;}				#cal-wrap table {border-collapse:collapse;width:100%;}				#cal-wrap .calendar-date {background:#fff;border-bottom:1px solid #ccc;padding:8px;color:#000;text-align:center;}				#cal-wrap .calendar-not-the-month {background:#fff;color:#ddd;}				#cal-wrap .calendar-today {background:#eee;}				#cal-wrap .highlight {background:#eee;}				#cal-wrap .calendar-hover {background:#eee;}				#cal-wrap .calendar-invalid {background:#FAEAC6;text-decoration: line-through;}				#calendar-op {color:#000;background:#eee;padding:8px;color:#000}				#calendar-op a {text-decoration:none;color:#000;}",n=document.createElement("style");n.type="text/css",n.styleSheet?n.styleSheet.cssText=a:n.appendChild(document.createTextNode(a)),document.getElementsByTagName("head")[0].appendChild(n);var t=document.createElement("div");document.body.appendChild(t),t.innerHTML=e},bind:function(){for(var a=dom.getElementsByClassName(calendarPicker.bindToClass),n=0,t=a.length;t>n;n++)a[n].onfocus=function(n){return function(){var t=a[n];calendarPicker.setDate(t.value),t.blur(),e.focus();var c=t.getAttribute("data-min-date"),r=t.getAttribute("data-max-date");c&&(s.minDate=parseDate(c)),r&&(s.maxDate=parseDate(r)),s.draw(o),calendarPicker.textbox=t,calendarPicker.show()}}(n),a[n].onblur=function(){};var c=function(a){var n=eventH.target(a);dom.contains(e,n)||calendarPicker.textbox==n||calendarPicker.hide()};eventTargetH.on(document,"click",c),eventTargetH.on(document,"keyup",c)},show:function(){e.style.display="block",e.style.position="absolute",n.style.display="block"},hide:function(){e.style.display="none",n.style.display="none"},setDate:function(e){return e=e||new Date,"string"==typeof e?(o=parseDate(e),o="Invalid Date"==o.toString()||isNaN(o)?new Date:o):o=e,o}}}();