function chkForm(t,e,a){return 1>=e?(alert("请正确填写「月经周期」，必须 >= 1"),!1):(1>=a&&alert("请正确填写「行经天数」，必须 >= 1"),!0)}function query(t,e,a){var n=14;if(t=t||parseDate($("#startdate").val()),e=e||parseInt($("#circle").val(),10),a=a||parseInt($("#days").val(),10)-1,chkForm.apply(this,arguments)){var r,s,o,i,l,c,g={r:"月经期",y:"排卵期",g:"安全期"},u={r:"请注意休息～",y:"受孕的可能性较大～",g:"受孕机率较小～"},D={r:["one-star","one-star","one-star","two-star"],y:["five-star","four-star","five-star","three-star"],g:["one-star","two-star","three-star","four-star"]},d={r:["休养，注意保暖","不宜吃酸辣食物"],y:["可适当运动","久坐不动"],g:["性感着装","无"]},f=t.getFullYear(),h=t.getMonth(),w=t.getDate();r=new Date(f,h,w-n),o=new Date(r.getFullYear(),r.getMonth(),r.getDate()-5),i=new Date(r.getFullYear(),r.getMonth(),r.getDate()+4),s=new Date(f,h,w+e-n),l=new Date(s.getFullYear(),s.getMonth(),s.getDate()-5),c=new Date(s.getFullYear(),s.getMonth(),s.getDate()+4),calInstance.ondrawing=function(n){var r=n.cell,s=n.date,y="g";if((s.range(o,i)||s.range(l,c))&&(y="y"),(s.range(new Date(f,h,w-e),new Date(f,h,w-e+a))||s.range(t,new Date(f,h,w+a))||s.range(new Date(f,h,w+e),new Date(f,h,w+e+a)))&&(y="r"),(new Date).format()==s.format()){$(".status").text(g[y]),$("#info .msg").text(u[y]);var v=D[y];$("#info .star-rating").each(function(t,e){$(e).removeClass(),$(e).addClass("star-rating "+v[t])}),$("#status .info").each(function(t,e){$(e).text(d[y][t])})}s.getMonth()==this.getCurrentDate().getMonth()&&(r.innerHTML='<div class="top">'+s.getDate()+'</div><div class="bottom '+y+'"></div>'),$(".selected-date").text(calInstance.currentDate.format("yyyy-MM-dd"))},setTimeout(function(){calInstance.draw(t)},10)}}function switchMonth(t){var e,a=calInstance.getCurrentDate(),n=parseInt($("#circle").val(),10),r=new Date(a.getFullYear(),a.getMonth()+t,a.getDate()),s=new Date(r.getFullYear(),r.getMonth(),1),o=new Date(r.getFullYear(),r.getMonth()+1,-1),i=1;do e=new Date(a.getFullYear(),a.getMonth(),a.getDate()+i*n),t>0?i++:i--;while(!e.range(s,o));return e}function initPage(){var t=document.getElementById("cal"),e=parseDate(t.getAttribute("data-min-date")),a=parseDate(t.getAttribute("data-max-date"));calInstance=new MonthlyCalendar({container:t,autoRows:!0,displayRows:5,minDate:e,displayDays:["日","一","二","三","四","五","六"],maxDate:a}),query()}var calInstance,currentDate;Date.prototype.range=function(t,e){var a="yyyyMMdd",n=parseInt(this.format(a),10),r=parseInt(t.format(a),10),s=parseInt(e.format(a),10);return n>=r&&s>=n?!0:!1},$(function(){$("#startdate").val((new Date).format()),initPage.call(),$("#query").tap(function(){query()}),$("#cal-prev").tap(function(){var t=switchMonth(-1);calInstance.setCurrentDate(t),query(t)}),$("#cal-next").tap(function(){var t=switchMonth(1);calInstance.setCurrentDate(t),query(t)}),Modernizr.inputtypes.date||calendarPicker.initialize()});