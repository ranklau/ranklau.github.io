<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  
  <title>tech | rank&#39;s blog</title>
  <meta name="author" content="rank">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

  
  <meta property="og:site_name" content="rank&#39;s blog"/>

  <link rel="alternate" href="/atom.xml" title="rank&#39;s blog" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <!--[if lt IE 9]><script src="http://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script><![endif]-->
  <script src="http://libs.baidu.com/jquery/1.8.0/jquery.min.js"></script>
  
</head>


<body>
  <div class="wrapper">
    <header id="header"><div class="title">
  <h1><a href="/">rank&#39;s blog</a></h1>
  <p><a href="/">Border is just for crossing</a></p>
</div>
<nav class="nav">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
      <li><a href="/labs">Labs</a></li>
    
      <li><a href="http://www.slideshare.net/ranklau/presentations">Slides</a></li>
    
      <li><a href="/about">About</a></li>
    
      <li><a href="/atom.xml">Feed</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
    <div class="content">
<h2 class="archive-title category">tech</h2>


  
    <article class="post">
  <header>
    
      <div class="icon"></div>
      <time datetime="2014-03-10T13:40:27.000Z"><a href="/2014/03/10/hexo-for-blog/">Mar 10 2014</a></time>
    
    
  
    <h1 class="title"><a href="/2014/03/10/hexo-for-blog/">用hexo在github page搭建博客</a></h1>
  

  </header>
  
  <div class="entry">
    
      <p>这两天把博客新迁在github page上，这两天抽空注册了新域名，并且在github pages上搭建了新的博客，还用了逼格极高的hexo。 </p>
<p>在github pages上搭建静态博客不只hexo，排名前5的系统有：</p>
<ul>
<li><a href="https://github.com/mojombo/jekyll" target="_blank">mojombo/jekyll</a>  最著名的静态博客引擎(ruby) </li>
<li><a href="https://github.com/imathis/octopress" target="_blank">imathis/octopress</a>  jekyll的一个框架，降低了使用难度</li>
<li><a href="https://github.com/tommy351/hexo" target="_blank">tommy351/hexo</a>  使用node编写的静态博客生成器</li>
<li><a href="https://github.com/getpelican/pelican" target="_blank">getpelican/pelican</a>  Python编写的静态博客生成器</li>
<li><a href="https://github.com/lepture/liquidluck" target="_blank">lepture/liquidluck</a>  同样也是Python的系统</li>
</ul>
<p>官方推荐的是 <a href="https://github.com/mojombo/jekyll" target="_blank">jekyll</a>。</p>
<p>我用hexo主要想借机多熟悉下node，另外也先看了简介使用，感觉hexo上手也相对容易，markdown语言来写内容。<br>如果你想对这几种静态博客进行系统比较的话，可自行测试，或 <a href="http://www.zhihu.com/question/21981094" target="_blank">参考这篇贴子</a>。</p>
<p>hexo的配置及使用官方有比较详细的 <a href="http://zespia.tw/hexo/docs/" target="_blank">文档</a> ，有一位热心同学写了较为详细的博文 《<a href="http://ibruce.info/2013/11/22/hexo-your-blog/" target="_blank">hexo你的博客</a>》 。  </p>
<p>有一些问题他没有提及，我补充一下：</p>
<ul>
<li><a href="https://github.com/tommy351/hexo/wiki/Themes" target="_blank">这里</a> 有详细的官方推荐皮肤。目前我使用的是<a href="https://github.com/heroicyang/hexo-theme-modernist" target="_blank">modernist</a>，如果你对皮肤要求比较高的话，恐怕theme上没有太满意的，只能自己设计。:(</li>
<li><a href="http://zespia.tw/hexo/docs/" target="_blank">文档</a>。看上去挺全的，但很多地方『点到即止』，所以才看到有很多使用说明都是自己搭建过的同学写出来的经验之谈，不过这没关系，结合google baidu来使用就可以了。</li>
<li><a href="http://zespia.tw/hexo/docs/migration.html" target="_blank">迁移</a>。 关键的功能从rss导入功能
&quot;hexo migrate rss <a href="http://rank.im/atom.xml">http://rank.im/atom.xml</a>&quot; 居然不能用。我哪天fix了放出来给大家。</li>
</ul>

    
  </div>
  <footer class="end-sep">
    
      
      
    
    <div class="clearfix"></div>
  </footer>
</article>


  
    <article class="post">
  <header>
    
      <div class="icon"></div>
      <time datetime="2013-10-09T11:12:05.000Z"><a href="/2013/10/09/cutandslice/">Oct 9 2013</a></time>
    
    
  
    <h1 class="title"><a href="/2013/10/09/cutandslice/">推荐android/ios开发切图神器cutandslice</a></h1>
  

  </header>
  
  <div class="entry">
    
      <p>在多端开发时切图是个很痛苦的事，如果有一个很好的工具必将解决掉很多很繁琐的工作。<br>最近试用了一款软件『cutandslice』，觉得不错，推荐给大家。<br>官网：<a href="http://www.cutandslice.me/" target="_blank">http://www.cutandslice.me/</a><br>作者从简介上来看是一名ue。  </p>
<p>用了之后你会发现其实开发的原理不难：<br>用了很多ps里自己的宏来解决问题，程序只处理了规则（rule）。这个思路真赞。</p>
<p><img src="http://www.cutandslice.me/css/layout/v1/ui/plugin.png" alt="&#39;cutandslice&#39;">

    
  </div>
  <footer class="end-sep">
    
      
        <div class="alignleft">
          <a href="/2013/10/09/cutandslice/#more" class="more-link">Read More</a>
        </div>
      
      
    
    <div class="clearfix"></div>
  </footer>
</article>


  
    <article class="post">
  <header>
    
      <div class="icon"></div>
      <time datetime="2012-12-13T06:54:40.000Z"><a href="/2012/12/13/get-script-path/">Dec 13 2012</a></time>
    
    
  
    <h1 class="title"><a href="/2012/12/13/get-script-path/">取得当前脚本元素的路径的一个特例</a></h1>
  

  </header>
  
  <div class="entry">
    
      <p>在正常情况下，无 defer 或 async 属性要准确取得当前脚本执行路径，在不同浏览器里有两种办法：</p>
<ol>
<li>在 <a href="https://developer.mozilla.org/en-US/docs/Web/API/document.currentScript" target="_blank">MDC</a> 里可查看到用 document.currentScript 拿到当前运用的 script 路径。除此属性外还可通过它的子属性 「document.currentScript.async」 来查看「异步」还是「同步」加载。</li>
<li>用 document.scripts 得到最后一个script.src，但需注意 readyState 是否为 「interactive」状态。</li>
</ol>

    
  </div>
  <footer class="end-sep">
    
      
        <div class="alignleft">
          <a href="/2012/12/13/get-script-path/#more" class="more-link">Read More</a>
        </div>
      
      
    
    <div class="clearfix"></div>
  </footer>
</article>


  
    <article class="post">
  <header>
    
      <div class="icon"></div>
      <time datetime="2012-09-12T03:11:54.000Z"><a href="/2012/09/12/fix-swfupload2.5-part2/">Sep 12 2012</a></time>
    
    
  
    <h1 class="title"><a href="/2012/09/12/fix-swfupload2.5-part2/">SWFUpload 2.5 bug 修改日志 II</a></h1>
  

  </header>
  
  <div class="entry">
    
      <p>在github上我放了一个<a href="https://github.com/ranklau/repos/tree/master/labs/swfupload2.5-fixed" target="_blank">修改版</a>，有兴趣的同学可以测试下性能。<br>需要注意的是，要在支持 PHP 的 Webserver 下运行。</p>
<h2 id="-">再遇问题</h2>
<p>经过上一轮的 SWFUpload 修改两周后有人反馈：</p>
<ul>
<li>上传速度非常慢，上传 8 张图片，有时甚至 8 分钟都没上传完；</li>
<li>其次是上传图片数量到某个阈值就无法上传；</li>
</ul>
<p>Debug了一个下午，发现：</p>
<ul>
<li>问题 1 上传速度慢的问题，只存在 IE 里。<ul>
<li>我也觉得很奇怪，为什么 Flash 的性能还和浏览器有差别</li>
</ul>
</li>
<li>问题 2 不是 Flash 的问题，与脚本使用有关<ul>
<li>经查问题发现 Flash 用 css 隐藏之后，在 IE 下压缩和上传都无法 work（这比较好查）；</li>
</ul>
</li>
</ul>

    
  </div>
  <footer class="end-sep">
    
      
        <div class="alignleft">
          <a href="/2012/09/12/fix-swfupload2.5-part2/#more" class="more-link">Read More</a>
        </div>
      
      
    
    <div class="clearfix"></div>
  </footer>
</article>


  
    <article class="post">
  <header>
    
      <div class="icon"></div>
      <time datetime="2012-08-18T07:08:51.000Z"><a href="/2012/08/18/fix-swfupload2.5-part1/">Aug 18 2012</a></time>
    
    
  
    <h1 class="title"><a href="/2012/08/18/fix-swfupload2.5-part1/">SWFUpload 2.5 bug 修改日志 I</a></h1>
  

  </header>
  
  <div class="entry">
    
      <h2 id="-swfupload">关于 SWFUpload</h2>
<blockquote>
<p>SWFUpload 是一个客户端文件上传工具，最初由Vinterwebb.se开发，它通过整合 Flash 与 JavaScript 技术为WEB开发者提供了一个具有丰富功能继而超越传统标签的文件上传模式。</p>
</blockquote>
<p>主要特点：</p>
<ul>
<li>可以同时上传多个文件；</li>
<li>类似AJAX的无刷新上传；</li>
<li>可以显示上传进度；</li>
<li>良好的浏览器兼容性；</li>
<li>兼容其他JavaScript库 (例如：jQuery, Prototype等)；</li>
<li>支持Flash 8和Flash 9；</li>
</ul>
<blockquote>
<p>SWFUpload 不同于其他基于 Flash 构建的上传工具，它有着优雅的代码设计，开发者可以利用 XHTML、 CSS和 JavaScript 来随心所欲的定制它在浏览器下的外观；它还提供了一组简明的 JavaScript 事件，借助它们开发者可以方便的在文件上传过程中更新页面内容来营造各种动态效果。</p>
</blockquote>
<p>这么多说的就是一个意思，SWFUpload 使用灵活方便，不少人在用。<br>但是，它在我们项目实际应用中发现问题。

    
  </div>
  <footer class="end-sep">
    
      
        <div class="alignleft">
          <a href="/2012/08/18/fix-swfupload2.5-part1/#more" class="more-link">Read More</a>
        </div>
      
      
    
    <div class="clearfix"></div>
  </footer>
</article>


  
    <article class="post">
  <header>
    
      <div class="icon"></div>
      <time datetime="2012-01-05T06:00:03.000Z"><a href="/2012/01/05/webkit-css3-blink/">Jan 5 2012</a></time>
    
    
  
    <h1 class="title"><a href="/2012/01/05/webkit-css3-blink/">webkit 里会出现突然闪一下的问题</a></h1>
  

  </header>
  
  <div class="entry">
    
      <h2 id="-">问题</h2>
<p>有用户反馈在 chrome 下出现屏幕会闪，但不是每次都能复现。  </p>
<h2 id="-">解决办法</h2>
<figure class="highlight css"><pre><span class="class">.no-flick</span><span class="rules">{<span class="rule"><span class="attribute">-webkit-backface-visibility</span>:<span class="value"> hidden</span></span>; <span class="comment">/*但不能用于sprite雪碧图*/</span><span class="rule">}</span></span>
<span class="comment">/* 或 */</span>
<span class="class">.no-flick</span><span class="rules">{<span class="rule"><span class="attribute">-webkit-transform</span>:<span class="value"><span class="function">translate3d(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>)</span></span></span>;<span class="rule">}</span></span>
</pre></figure>



    
  </div>
  <footer class="end-sep">
    
      
        <div class="alignleft">
          <a href="/2012/01/05/webkit-css3-blink/#more" class="more-link">Read More</a>
        </div>
      
      
    
    <div class="clearfix"></div>
  </footer>
</article>


  
    <article class="post">
  <header>
    
      <div class="icon"></div>
      <time datetime="2011-04-07T15:45:43.000Z"><a href="/2011/04/07/user-behavior-record-data/">Apr 7 2011</a></time>
    
    
  
    <h1 class="title"><a href="/2011/04/07/user-behavior-record-data/">用户行为系统 如何记录行为数据</a></h1>
  

  </header>
  
  <div class="entry">
    
      <p>最近准备把我主持并负责的前端用户行为系统开源了，这个系统我们内部命名为 marmot。中文为「土拨鼠」，有挖掘之意。
除我之外，还有两位开发人员分别是：seven 和 cyhello。</p>
<p>本篇文章简短的说明一下 marmot 的 log 重点问题：</p>
<ol>
<li>解决不同分辩率的策略.</li>
<li>解决粒度过细的问题.</li>
<li>还原路径问题.</li>
<li>何时发回数据及数据量的问题</li>
</ol>

    
  </div>
  <footer class="end-sep">
    
      
        <div class="alignleft">
          <a href="/2011/04/07/user-behavior-record-data/#more" class="more-link">Read More</a>
        </div>
      
      
    
    <div class="clearfix"></div>
  </footer>
</article>


  
    <article class="post">
  <header>
    
      <div class="icon"></div>
      <time datetime="2010-08-29T06:09:15.000Z"><a href="/2010/08/29/simulate-dom-inspect-effect/">Aug 29 2010</a></time>
    
    
  
    <h1 class="title"><a href="/2010/08/29/simulate-dom-inspect-effect/">模拟里firebug的 DOM inspect 功能</a></h1>
  

  </header>
  
  <div class="entry">
    
      <h2 id="-">常规思路</h2>
<p>在firefox里如何实现firebug的DOM inspect选择功能?</p>
<ul>
<li>首先，我们会document里添加mouseover事件时在HTMLElement上飘一个absolute的容器，设置border。</li>
<li>接着，mousedown，这个 absolute 的元素隐藏；</li>
<li>再着着，click 结束后从事件里的 event 得到 target，从而再得到 inspect。</li>
</ul>
<p>可这样是不是真的能做到呢？

    
  </div>
  <footer class="end-sep">
    
      
        <div class="alignleft">
          <a href="/2010/08/29/simulate-dom-inspect-effect/#more" class="more-link">Read More</a>
        </div>
      
      
    
    <div class="clearfix"></div>
  </footer>
</article>


  
    <article class="post">
  <header>
    
      <div class="icon"></div>
      <time datetime="2008-12-20T17:04:33.000Z"><a href="/2008/12/21/ie6-ssl-ajax-trouble/">Dec 21 2008</a></time>
    
    
  
    <h1 class="title"><a href="/2008/12/21/ie6-ssl-ajax-trouble/">IE6 SP1+SSL+AJAX(XMLHttpRequest)=trouble</a></h1>
  

  </header>
  
  <div class="entry">
    
      <h2 id="-">问题描述</h2>
<p>在 IE 6 SP1 访问 https 站点，AJAX 会随机出现一个 winet 的状态码：12152。<br><a href="http://www.baidu.com/s?tn=ichuner_4_pg&amp;ie=gb2312&amp;bs=xmlhttp+12152&amp;sr=&amp;z=&amp;cl=3&amp;f=8&amp;wd=ajax+12152&amp;ct=0" target="_blank">网上</a>有不少人遇到了这困惑的状态码。</p>
<p>说明</p>
<ul>
<li>Windows 下的 IE 里 new ActiveXObject(progId) 生成的 XMLHttpRequest 是 winet 的一部分。</li>
<li>IE 7以下对 SSL (即 HTTPS) 的支持不够好。</li>
</ul>

    
  </div>
  <footer class="end-sep">
    
      
        <div class="alignleft">
          <a href="/2008/12/21/ie6-ssl-ajax-trouble/#more" class="more-link">Read More</a>
        </div>
      
      
    
    <div class="clearfix"></div>
  </footer>
</article>


  
    <article class="post">
  <header>
    
      <div class="icon"></div>
      <time datetime="2008-11-24T12:34:57.000Z"><a href="/2008/11/24/radio-list-user-experience-detail/">Nov 24 2008</a></time>
    
    
  
    <h1 class="title"><a href="/2008/11/24/radio-list-user-experience-detail/">radio list的用户体验细节</a></h1>
  

  </header>
  
  <div class="entry">
    
      <p>radio list的用户体验细节相当赞：</p>
<ul>
<li>可支持方向键</li>
<li>当radio最后一个选中时，按小键盘后会自动跳回第一个</li>
<li>checked可自动触发onclick</li>
<li>支持各种浏览器,cross-browser</li>
</ul>
<p>用这个特性，可以做一个无障碍的TabView:)</p>
<p>
    
  </div>
  <footer class="end-sep">
    
      
        <div class="alignleft">
          <a href="/2008/11/24/radio-list-user-experience-detail/#more" class="more-link">Read More</a>
        </div>
      
      
    
    <div class="clearfix"></div>
  </footer>
</article>


  
    <article class="post">
  <header>
    
      <div class="icon"></div>
      <time datetime="2008-11-24T12:20:21.000Z"><a href="/2008/11/24/trim-to-regexp-performance/">Nov 24 2008</a></time>
    
    
  
    <h1 class="title"><a href="/2008/11/24/trim-to-regexp-performance/">从 trim 原型函数看 JS 正则表达式的性能</a></h1>
  

  </header>
  
  <div class="entry">
    
      <h2 id="-">问题</h2>
<p>如果你看到别人写 trim 函数是用循环而不用正则表达式来写，请不要取笑，也许他们踩过坑。<br>如果你很自信你的 trim 函数效率很高，请看完本文再下结论。</p>
<p>一般情况下用正则写法为：</p>
<figure class="highlight js"><pre>&lt;script type=<span class="string">"text/javascript"</span>&gt;<span class="comment">//&lt;![CDATA[</span>
  <span class="built_in">String</span>.prototype.trim = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
    <span class="keyword">return</span> <span class="keyword">this</span>.replace(<span class="regexp">/^[\s\t ]+|[\s\t ]+$/g</span>, <span class="string">''</span>);
  }
  s = <span class="string">' rank\'s weblog, www.rank.im '</span>;
  alert(s.trim().length);
<span class="comment">//]]&gt;&lt;/script&gt;</span>
</pre></figure>


<p>如果遇到大数据的变长字符串的话就会发现这个是很耗资源的。<br>效率并不高，有的时候甚至无法忍受。</p>

    
  </div>
  <footer class="end-sep">
    
      
        <div class="alignleft">
          <a href="/2008/11/24/trim-to-regexp-performance/#more" class="more-link">Read More</a>
        </div>
      
      
    
    <div class="clearfix"></div>
  </footer>
</article>


  
    <article class="post">
  <header>
    
      <div class="icon"></div>
      <time datetime="2008-08-23T10:56:41.000Z"><a href="/2008/08/23/firefox-regexp-issue/">Aug 23 2008</a></time>
    
    
  
    <h1 class="title"><a href="/2008/08/23/firefox-regexp-issue/">Firefox 2 正则表达式全半角问题</a></h1>
  

  </header>
  
  <div class="entry">
    
      <h2 id="-">问题</h2>
<p>先问一个问题, 在firefox 2里,正则表达式字符&quot;\d&quot;全等于&quot;[0-9]&quot;吗?</p>
<p>有可能你会答「是，他们相等」，也有可能你去查了查手册, 看到以下的解释:</p>
<blockquote>
<p>\d Matches a nondigit character. Equivalent to [^0-9]. 
匹配一个数字字符。等价于 [0-9]。</p>
</blockquote>
<p>那我们测试一下以下代码：</p>
<figure class="highlight js"><pre> <span class="comment">//http://rank.im</span>
 alert(<span class="regexp">/^\d{2}$/</span>.test(<span class="string">"１２"</span>));
 alert(<span class="string">'请注意,１２是全角'</span>);
</pre></figure>



    
  </div>
  <footer class="end-sep">
    
      
        <div class="alignleft">
          <a href="/2008/08/23/firefox-regexp-issue/#more" class="more-link">Read More</a>
        </div>
      
      
    
    <div class="clearfix"></div>
  </footer>
</article>


  
    <article class="post">
  <header>
    
      <div class="icon"></div>
      <time datetime="2008-07-20T11:44:21.000Z"><a href="/2008/07/20/ie-form-check-bug/">Jul 20 2008</a></time>
    
    
  
    <h1 class="title"><a href="/2008/07/20/ie-form-check-bug/">IE 在 DOM 操作有表单控件时的bug</a></h1>
  

  </header>
  
  <div class="entry">
    
      <h2 id="bug-">bug描述</h2>
<ul>
<li>影响的范围: IE的所有版本</li>
<li>在表单的 radio/checkbox 控件中，一旦他们的DOM结构被更改过就会出现这个bug。</li>
<li>操作了表单 radio/checkbox 的 DOM 结构时（或者直接影响了他们的结构时）选中的 checkbox/radio将会自动恢复到默认状态，</li>
<li>有如点了 reset 按钮一样。</li>
</ul>
<p>
    
  </div>
  <footer class="end-sep">
    
      
        <div class="alignleft">
          <a href="/2008/07/20/ie-form-check-bug/#more" class="more-link">Read More</a>
        </div>
      
      
    
    <div class="clearfix"></div>
  </footer>
</article>


  
    <article class="post">
  <header>
    
      <div class="icon"></div>
      <time datetime="2006-09-30T08:36:17.000Z"><a href="/2006/09/30/javascript-dom-range-1/">Sep 30 2006</a></time>
    
    
  
    <h1 class="title"><a href="/2006/09/30/javascript-dom-range-1/">Javascript 标准 DOM Range操作(1)</a></h1>
  

  </header>
  
  <div class="entry">
    
      <ul>
<li><a href="http://rank.im/2006/09/30/javascript-dom-range-2/">Javascript标准DOM Range操作(2)</a></li>
<li><a href="http://rank.im/2006/09/30/javascript-dom-range-3/">Javascript标准DOM Range操作(3)</a></li>
</ul>
<h2 id="createrange-">createRange 方法</h2>
<p>2 级 DOM 定义了一个 createRange() 方法，如果是按照DOM此标准的浏览器（IE 并不是支持此标准的，但是 IE 里的属性或方法却远比标准中的功能多得多），它属于 document 对象，所以创建一个 range 对象：</p>
<figure class="highlight js"><pre><span class="keyword">var</span> oRange = document.createRange();
</pre></figure>


<p>如果你要检测你的浏览器是否支持此标准Range对象，可以用hasFeature()方法来检测：</p>
<figure class="highlight js"><pre><span class="keyword">var</span> supportsDOMRanges = document.implementation.hasFeature(<span class="string">"Range"</span>, <span class="string">"2.0"</span>);
<span class="keyword">if</span> (supportsDOMRange) {
<span class="keyword">var</span> oRange = document.createRange();
<span class="comment">//range code here</span>
}
</pre></figure>


<p>
    
  </div>
  <footer class="end-sep">
    
      
        <div class="alignleft">
          <a href="/2006/09/30/javascript-dom-range-1/#more" class="more-link">Read More</a>
        </div>
      
      
    
    <div class="clearfix"></div>
  </footer>
</article>


  
    <article class="post">
  <header>
    
      <div class="icon"></div>
      <time datetime="2006-09-30T08:36:17.000Z"><a href="/2006/09/30/javascript-dom-range-2/">Sep 30 2006</a></time>
    
    
  
    <h1 class="title"><a href="/2006/09/30/javascript-dom-range-2/">Javascript 标准 DOM Range操作(2)</a></h1>
  

  </header>
  
  <div class="entry">
    
      <ul>
<li><a href="http://rank.im/2006/09/30/javascript-dom-range-1/">Javascript标准DOM Range操作(1)</a></li>
<li><a href="http://rank.im/2006/09/30/javascript-dom-range-3/">Javascript标准DOM Range操作(3)</a></li>
</ul>
<h2 id="-dom-range">复杂DOM Range</h2>
<p>建立复杂的 DOM range 需要使用 setStart() 和 setEnd() 两个方法。
这两个方法有两个参数：</p>
<ul>
<li>一个参数是一个节点 (node)引用；</li>
<li>另一个参数是偏移量 (offset)。</li>
</ul>
<p>这两个方法的功能：</p>
<ul>
<li>setStart(node, offset) 节点的引用是 startContainer，偏移则是 startOffset；</li>
<li>setEnd(node, offset) 节点引用为 endContainer，偏移就是 endOffset。</li>
</ul>
<p>使用这两个方法与 selectNode() 和 selectNodeContents() 方法相似。<br>比如下面 useRanges() 函数的前一个示例，可以使用 setStart() 和 setEnd():</p>
<figure class="highlight js"><pre><span class="function"><span class="keyword">function</span> <span class="title">useRanges</span><span class="params">()</span> {</span>
	<span class="keyword">var</span> oRange1 = document.createRange();
	<span class="keyword">var</span> oRange2 = document.createRange();
	<span class="keyword">var</span> oP1 = document.getElementById(<span class="string">"p1"</span>);
	<span class="keyword">var</span> iP1Index = -<span class="number">1</span>;
	<span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i &lt; oP1.parentNode.childNodes.length; i++) {
		<span class="keyword">if</span> (oP1.parentNode.childNodes[i] == oP1) {
			iP1Index = i;
			<span class="keyword">break</span>;
		}
	}
	
	oRange1.setStart(oP1.parentNode, iP1Index);
	oRange1.setEnd(oP1.parentNode, iP1Index + <span class="number">1</span>);
	oRange2.setStart(oP1, <span class="number">0</span>);
	oRange2.setEnd(oP1, oP1.childNodes.length);
	<span class="comment">//textbox assignments here</span>
}
</pre></figure>


<p>注意，这个选择节点时的代码 (oRange1)，你必须指定 oP1 父节点里所有 childNodes 集合里的一个索引。<br>而选择内容时的代码 (oRange2)，则不需要额外考虑。</p>
<ul>
<li>从刚才的例子来从这段HTML里&lt;p id=&quot;p1&quot;&gt;&lt;b&gt;Hello&lt;/b&gt; World&lt;/p&gt;</li>
<li>选择从 hello 中的 llo 开始到从 World 中的 Wo 开始的 Range，我们用setStart()和setEnd()，很容易就做到了。</li>
</ul>
<p>首先，我们必须用常规的 DOM 方法得到文本节点的引用还有就是容器 p1 的引用。</p>
<figure class="highlight js"><pre><span class="keyword">var</span> oP1 = document.getElementById(<span class="string">"p1"</span>);
<span class="keyword">var</span> oHello = oP1.firstChild.firstChild;
<span class="keyword">var</span> oWorld = oP1.lastChild;
</pre></figure>



<ul>
<li>文本 Hello 实际上是容器 p1 的孙子节点，所以我们可以用 oP1.firstChild 得到 b 元素，</li>
<li>oP1.firstChild.firstChild 也就是 Hello 文本节点的引用了，而 World 则就是容器 p1 的最后一个节点了。</li>
</ul>
<p>下一步，建立range然后设置偏移(offset)：</p>
<figure class="highlight js"><pre><span class="keyword">var</span> oP1 = document.getElementById(<span class="string">"p1"</span>);
<span class="keyword">var</span> oHello = oP1.firstChild.firstChild;
<span class="keyword">var</span> oWorld = oP1.lastChild;
<span class="keyword">var</span> oRange = document.createRange();
oRange.setStart(oHello, <span class="number">2</span>);
oRange.setEnd(oWorld, <span class="number">3</span>);
</pre></figure>


<ul>
<li>用 setStart() 偏移 (offset)为 2。<br>因为字母 l 在该文本节点中 (即 Hello 中) 的位置是 2，(位置是从 0 开始计算的)，</li>
<li>用 setEnd() 的偏移 (offset) 为 3。<br>原因同上，需要注意的是 World 前面有一个空格，空格也是占位置的。如图：</li>
</ul>
<p><img src="/images/javascript-dom-range/30_141714_domranges3.gif" alt="range demo"></p>
<blockquote>
<p>注意：(Mozilla DOM Range bug #135928)在 Mozilla低版本浏览器 执行此Range方法时，如果 setStart()和 setEnd() 都指向同一个文本节点会出现异常。</p>
</blockquote>
<h2 id="-dom-range-">用DOM Range操作</h2>
<p>当创建一个 Range 对象时，在 Range 里的所有对象之上，已经创建了一个文档的 fragment 节点。<br>在这之前，Range 对象必须合格证你选择的这段Range是一个 well-formed（格式良好）。<br>比如以面这段 Range：</p>
<p><img src="/images/javascript-dom-range/30_165636_domranges4.gif" alt="range demo"></p>
<p>在这里 HTML 并不是一个 well-formed。<br>上面也说过，当创建一个 Range 时，会自动产生一个 fragment。<br>在这里 framgment 自动动态的添加一些元素，以保证 Range 的正确性：</p>
<figure class="highlight html"><pre><span class="tag">&lt;<span class="title">p</span>&gt;</span><span class="tag">&lt;<span class="title">b</span>&gt;</span>He<span class="tag">&lt;/<span class="title">b</span>&gt;</span><span class="tag">&lt;<span class="title">b</span>&gt;</span>llo<span class="tag">&lt;/<span class="title">b</span>&gt;</span> World<span class="tag">&lt;/<span class="title">p</span>&gt;</span>
</pre></figure>


<p>也就是自动加上了开始标签&lt;b&gt;，使得整个 Range 变为：</p>
<figure class="highlight html"><pre><span class="tag">&lt;<span class="title">b</span>&gt;</span>llo<span class="tag">&lt;/<span class="title">b</span>&gt;</span> Wo，
</pre></figure>


<p>fragment的示意图为：</p>
<p><img src="/images/javascript-dom-range/30_170131_domranges5.gif" alt="range demo"></p>
<p>当此fragment创建后，你就可以用Range的一些方法来操作它了。</p>
<p>最简单的一个操作就是：deleteContents()方法，这个方法将删除Range选中的部分，在上面的操作之后进行deleteContents()，那么余下的HTML就为：</p>
<figure class="highlight html"><pre><span class="tag">&lt;<span class="title">p</span>&gt;</span><span class="tag">&lt;<span class="title">b</span>&gt;</span>He<span class="tag">&lt;/<span class="title">b</span>&gt;</span>rld<span class="tag">&lt;/<span class="title">p</span>&gt;</span>
</pre></figure>


<p>之所以加上闭合标签 </b>，上面也说了，也是 Range 为了确保它是 well-formed。</p>
<p>extractContents() 方法类似于 deleteContents()，但具体操作不同。  </p>
<p>extractContents()是将选中的Range从DOM树中移到一个fragment中，并返回此fragment，复制下面这些代码然后在Mozilla Firefox里运行，看看结果你就明白了。——删除的</p>
<figure class="highlight html"><pre><span class="tag">&lt;<span class="title">b</span>&gt;</span>llo<span class="tag">&lt;/<span class="title">b</span>&gt;</span> Wo
</pre></figure>


<p>作为一个fragment被添加到 body 的末端。</p>
<figure class="highlight html"><pre><span class="tag">&lt;<span class="title">p</span> <span class="attribute">id</span>=<span class="value">"p1"</span>&gt;</span><span class="tag">&lt;<span class="title">b</span>&gt;</span>Hello<span class="tag">&lt;/<span class="title">b</span>&gt;</span> World<span class="tag">&lt;/<span class="title">p</span>&gt;</span>
<span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript">
<span class="keyword">var</span> oP1 = document.getElementById(<span class="string">"p1"</span>);
<span class="keyword">var</span> oHello = oP1.firstChild.firstChild;
<span class="keyword">var</span> oWorld = oP1.lastChild;
<span class="keyword">var</span> oRange = document.createRange();
oRange.setStart(oHello, <span class="number">2</span>);
oRange.setEnd(oWorld, <span class="number">3</span>);
<span class="keyword">var</span> oFragment = oRange.extractContents();
document.body.appendChild(oFragment);
</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
</pre></figure>


<p>cloneContents()方法可以克隆选中Range的fragment，比如：</p>
<figure class="highlight html"><pre><span class="tag">&lt;<span class="title">p</span> <span class="attribute">id</span>=<span class="value">"p1"</span>&gt;</span><span class="tag">&lt;<span class="title">b</span>&gt;</span>Hello<span class="tag">&lt;/<span class="title">b</span>&gt;</span> World<span class="tag">&lt;/<span class="title">p</span>&gt;</span>
<span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript">
<span class="keyword">var</span> oP1 = document.getElementById(<span class="string">"p1"</span>);
<span class="keyword">var</span> oHello = oP1.firstChild.firstChild;
<span class="keyword">var</span> oWorld = oP1.lastChild;
<span class="keyword">var</span> oRange = document.createRange();
oRange.setStart(oHello, <span class="number">2</span>);
oRange.setEnd(oWorld, <span class="number">3</span>);
<span class="keyword">var</span> oFragment = oRange.cloneContents();
document.body.appendChild(oFragment);
</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
</pre></figure>


<p>这个方法类似于extractContents()，但是不是删除，而是克隆。</p>

    
  </div>
  <footer class="end-sep">
    
      
      
    
    <div class="clearfix"></div>
  </footer>
</article>


  

  <nav id="pagination">
  
  
  <div class="clearfix"></div>
</nav>

</div>
  </div>
  <div class="widget-wrapper">
    <aside id="sidebar">
  
  
    
      
      

<div class="widget tag first">
  <h3 class="title">Categories</h3>
  <ul class="entry">
  
    <li><a href="/categories/tech/">tech</a><small>15</small></li>
  
  </ul>
</div>

    
      
      
    
      
      

<div class="widget recent-posts">
  <h3 class="title">Recent Posts</h3>
  <ul class="entry">
    
      <li>
        <a href="/2014/03/10/hexo-for-blog/">用hexo在github page搭建博客</a>
      </li>
    
      <li>
        <a href="/2014/03/07/new-blog-start/">换域名，重新开博</a>
      </li>
    
      <li>
        <a href="/2013/10/09/cutandslice/">推荐android/ios开发切图神器cutandslice</a>
      </li>
    
      <li>
        <a href="/2012/12/13/get-script-path/">取得当前脚本元素的路径的一个特例</a>
      </li>
    
      <li>
        <a href="/2012/09/12/fix-swfupload2.5-part2/">SWFUpload 2.5 bug 修改日志 II</a>
      </li>
    
  </ul>
</div>

    
      
      

<div class="widget blogroll">
  <h3 class="title">Links</h3>
  <ul class="entry">
  
    
    <li><a href="http://wuduoyi.com/" target="_blank">wuduoyi</a></li>
  
    
    <li><a href="http://fex.baidu.com/" target="_blank">FEX team</a></li>
  
  </ul>
</div>

    
      
      
    
  
</aside>
<div class="clearfix"></div>
  </div>
  <footer id="footer"><div class="copyright">
  
  &copy; 2014 <a href="/">rank</a>
  
</div>
<div class="theme-copyright">
  Theme by <a href="https://github.com/orderedlist" target="_blank">orderedlist</a>
   | 
  Redesign by <a href="http://heroicyang.com/" target="_blank">Heroic Yang</a>
</div>
<div class="clearfix"></div></footer>
  <script src="/js/scale.fix.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>


<script type="text/javascript">
  var disqus_shortname = 'ranklau';

  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  }());
</script>



<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
  (function($){
    $('.fancybox').fancybox();
  })(jQuery);
</script>

</body>
</html>